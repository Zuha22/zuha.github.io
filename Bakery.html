<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cake Shop</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      width: 100%;
    }
    
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    .cart-badge {
      min-width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .product-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      transition: all 0.2s;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" style="width: 100%; height: 100%; display: flex; flex-direction: column;"><!-- Navigation -->
   <nav id="navbar" style="width: 100%; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <div>
     <h1 id="shop-name" style="font-size: 28px; font-weight: bold; margin: 0;">Sweet Delights Bakery</h1>
     <p id="tagline" style="font-size: 14px; margin: 4px 0 0 0; opacity: 0.8;">Freshly Baked with Love</p>
    </div>
    <div style="display: flex; gap: 32px; align-items: center;"><a href="#home" class="nav-link" style="text-decoration: none; font-weight: 500; font-size: 16px; transition: opacity 0.2s;">Home</a> <a href="#about" class="nav-link" style="text-decoration: none; font-weight: 500; font-size: 16px; transition: opacity 0.2s;">About</a> <a href="#contact" class="nav-link" style="text-decoration: none; font-weight: 500; font-size: 16px; transition: opacity 0.2s;">Contact</a> <a href="#cart" class="nav-link" style="text-decoration: none; font-weight: 500; font-size: 16px; position: relative; transition: opacity 0.2s;"> Cart <span id="cart-badge" class="cart-badge" style="position: absolute; top: -8px; right: -12px; border-radius: 10px; font-size: 12px; font-weight: bold; padding: 2px 6px;">0</span> </a>
    </div>
   </nav><!-- Main Content -->
   <main style="flex: 1; overflow-y: auto; width: 100%;"><!-- Home Page -->
    <div id="home-page" class="page active">
     <div style="width: 100%; padding: 60px 40px;"><!-- Hero Section -->
      <div style="text-align: center; margin-bottom: 60px;">
       <h2 style="font-size: 48px; font-weight: bold; margin-bottom: 16px;">Delicious Cakes for Every Occasion</h2>
       <p style="font-size: 20px; opacity: 0.8; max-width: 600px; margin: 0 auto;">Handcrafted with premium ingredients and love</p>
      </div><!-- Products Grid -->
      <div style="max-width: 1200px; margin: 0 auto;">
       <h3 style="font-size: 32px; font-weight: bold; margin-bottom: 32px; text-align: center;">Our Cakes</h3>
       <div id="products-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 32px;"></div>
      </div>
     </div>
    </div><!-- About Page -->
    <div id="about-page" class="page">
     <div style="width: 100%; padding: 60px 40px;">
      <div style="max-width: 800px; margin: 0 auto;">
       <h2 style="font-size: 48px; font-weight: bold; margin-bottom: 32px; text-align: center;">About Us</h2>
       <div style="background: white; padding: 48px; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);">
        <p id="about-description" style="font-size: 18px; line-height: 1.8; margin-bottom: 24px;">Welcome to Sweet Delights Bakery! For over 15 years, we've been crafting the finest cakes using traditional recipes and premium ingredients. Each cake is made fresh daily with love and attention to detail.</p>
        <p style="font-size: 18px; line-height: 1.8; margin-bottom: 24px;">Our passionate team of bakers brings years of experience and creativity to every creation. From classic flavors to custom designs, we're here to make your celebrations extra special.</p>
        <p style="font-size: 18px; line-height: 1.8;">Visit us today and taste the difference that quality ingredients and expert craftsmanship make!</p>
       </div>
      </div>
     </div>
    </div><!-- Cart Page -->
    <div id="cart-page" class="page">
     <div style="width: 100%; padding: 60px 40px;">
      <div style="max-width: 900px; margin: 0 auto;">
       <h2 style="font-size: 48px; font-weight: bold; margin-bottom: 32px; text-align: center;">Shopping Cart</h2>
       <div id="cart-items" style="background: white; padding: 32px; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);"></div>
      </div>
     </div>
    </div><!-- Contact Page -->
    <div id="contact-page" class="page">
     <div style="width: 100%; padding: 60px 40px;">
      <div style="max-width: 600px; margin: 0 auto;">
       <h2 id="contact-heading" style="font-size: 48px; font-weight: bold; margin-bottom: 16px; text-align: center;">Get In Touch</h2>
       <p style="font-size: 18px; opacity: 0.8; margin-bottom: 40px; text-align: center;">Have questions or special requests? We'd love to hear from you!</p>
       <form id="contact-form" style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);">
        <div style="margin-bottom: 24px;"><label for="name-input" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 16px;">Name</label> <input type="text" id="name-input" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; transition: border-color 0.2s;">
        </div>
        <div style="margin-bottom: 24px;"><label for="email-input" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 16px;">Email</label> <input type="email" id="email-input" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; transition: border-color 0.2s;">
        </div>
        <div style="margin-bottom: 24px;"><label for="phone-input" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 16px;">Phone</label> <input type="tel" id="phone-input" required style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; transition: border-color 0.2s;">
        </div>
        <div style="margin-bottom: 32px;"><label for="message-input" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 16px;">Message</label> <textarea id="message-input" required rows="5" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; resize: vertical; transition: border-color 0.2s;"></textarea>
        </div><button type="submit" id="submit-btn" class="btn-primary" style="width: 100%; padding: 16px; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;"> <span id="submit-text">Send Message</span> </button>
       </form>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#fef3f3",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_action_color: "#ec4899",
      secondary_action_color: "#f472b6",
      font_family: "ui-sans-serif, system-ui, -apple-system, sans-serif",
      font_size: 16,
      shop_name: "Sweet Delights Bakery",
      tagline: "Freshly Baked with Love",
      about_text: "Welcome to Sweet Delights Bakery! For over 15 years, we've been crafting the finest cakes using traditional recipes and premium ingredients. Each cake is made fresh daily with love and attention to detail.",
      contact_heading: "Get In Touch"
    };

    const products = [
      { id: 1, name: "Chocolate Dream", price: 35, emoji: "üç´" },
      { id: 2, name: "Strawberry Delight", price: 32, emoji: "üçì" },
      { id: 3, name: "Vanilla Classic", price: 28, emoji: "üç∞" },
      { id: 4, name: "Red Velvet", price: 38, emoji: "‚ù§Ô∏è" },
      { id: 5, name: "Lemon Zest", price: 30, emoji: "üçã" },
      { id: 6, name: "Carrot Cake", price: 33, emoji: "ü•ï" }
    ];

    let cart = [];
    let contactSubmissions = [];

    const dataHandler = {
      onDataChanged(data) {
        contactSubmissions = data;
      }
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'ui-sans-serif, system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      document.body.style.background = config.background_color || defaultConfig.background_color;
      document.body.style.color = config.text_color || defaultConfig.text_color;
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      document.getElementById('navbar').style.background = config.surface_color || defaultConfig.surface_color;
      document.getElementById('navbar').style.color = config.text_color || defaultConfig.text_color;
      
      document.getElementById('shop-name').style.fontSize = `${baseSize * 1.75}px`;
      document.getElementById('tagline').style.fontSize = `${baseSize * 0.875}px`;
      
      document.getElementById('shop-name').textContent = config.shop_name || defaultConfig.shop_name;
      document.getElementById('tagline').textContent = config.tagline || defaultConfig.tagline;
      document.getElementById('about-description').textContent = config.about_text || defaultConfig.about_text;
      document.getElementById('contact-heading').textContent = config.contact_heading || defaultConfig.contact_heading;
      
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.style.color = config.text_color || defaultConfig.text_color;
        link.style.fontSize = `${baseSize}px`;
      });
      
      const cartBadge = document.getElementById('cart-badge');
      cartBadge.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      cartBadge.style.color = config.surface_color || defaultConfig.surface_color;
      
      const allH2 = document.querySelectorAll('h2');
      allH2.forEach(h2 => {
        h2.style.fontSize = `${baseSize * 3}px`;
        h2.style.color = config.text_color || defaultConfig.text_color;
      });
      
      const allH3 = document.querySelectorAll('h3');
      allH3.forEach(h3 => {
        h3.style.fontSize = `${baseSize * 2}px`;
        h3.style.color = config.text_color || defaultConfig.text_color;
      });
      
      const allParagraphs = document.querySelectorAll('p');
      allParagraphs.forEach(p => {
        if (!p.id) {
          p.style.fontSize = `${baseSize * 1.125}px`;
        }
      });
      
      document.querySelectorAll('input, textarea').forEach(input => {
        input.style.fontSize = `${baseSize}px`;
        input.style.borderColor = config.text_color || defaultConfig.text_color;
        input.addEventListener('focus', () => {
          input.style.borderColor = config.primary_action_color || defaultConfig.primary_action_color;
        });
        input.addEventListener('blur', () => {
          input.style.borderColor = '#e5e7eb';
        });
      });
      
      document.querySelectorAll('label').forEach(label => {
        label.style.fontSize = `${baseSize}px`;
        label.style.color = config.text_color || defaultConfig.text_color;
      });
      
      document.getElementById('submit-text').style.fontSize = `${baseSize * 1.125}px`;
      
      renderProducts();
      renderCart();
    }

    function renderProducts() {
      const config = window.elementSdk?.config || defaultConfig;
      const grid = document.getElementById('products-grid');
      grid.innerHTML = products.map(product => `
        <div class="product-card" style="background: ${config.surface_color || defaultConfig.surface_color}; padding: 24px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
          <div style="font-size: 80px; margin-bottom: 16px;">${product.emoji}</div>
          <h4 style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 600; margin-bottom: 8px; color: ${config.text_color || defaultConfig.text_color};">${product.name}</h4>
          <p style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: bold; margin-bottom: 16px; color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${product.price}</p>
          <button onclick="addToCart(${product.id})" class="btn-primary" style="width: 100%; padding: 12px 24px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: ${config.surface_color || defaultConfig.surface_color}; border: none; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 600; cursor: pointer;">
            Add to Cart
          </button>
        </div>
      `).join('');
    }

    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      
      updateCartBadge();
      renderCart();
      showToast('Added to cart!');
    }

    function updateCartBadge() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-badge').textContent = totalItems;
    }

    function renderCart() {
      const config = window.elementSdk?.config || defaultConfig;
      const container = document.getElementById('cart-items');
      
      if (cart.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 80px; margin-bottom: 16px;">üõí</div>
            <p style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">Your cart is empty</p>
          </div>
        `;
        return;
      }
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      container.innerHTML = `
        <div>
          ${cart.map((item, index) => `
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; border-bottom: 2px solid #f3f4f6; ${index === cart.length - 1 ? 'border-bottom: none;' : ''}">
              <div style="display: flex; align-items: center; gap: 16px;">
                <div style="font-size: 48px;">${item.emoji}</div>
                <div>
                  <h4 style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 600; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">${item.name}</h4>
                  <p style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">$${item.price} each</p>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 16px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <button onclick="updateQuantity(${item.id}, -1)" style="width: 32px; height: 32px; border-radius: 6px; border: 2px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}; background: transparent; color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center;">‚àí</button>
                  <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 600; min-width: 24px; text-align: center; color: ${config.text_color || defaultConfig.text_color};">${item.quantity}</span>
                  <button onclick="updateQuantity(${item.id}, 1)" style="width: 32px; height: 32px; border-radius: 6px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; background: transparent; color: ${config.primary_action_color || defaultConfig.primary_action_color}; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center;">+</button>
                </div>
                <p style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: bold; min-width: 80px; text-align: right; color: ${config.text_color || defaultConfig.text_color};">$${(item.price * item.quantity).toFixed(2)}</p>
                <button onclick="removeFromCart(${item.id})" style="padding: 8px 12px; background: transparent; border: none; color: #ef4444; cursor: pointer; font-size: 24px;">üóëÔ∏è</button>
              </div>
            </div>
          `).join('')}
          <div style="margin-top: 32px; padding-top: 24px; border-top: 3px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: bold; color: ${config.text_color || defaultConfig.text_color};">Total:</span>
            <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: bold; color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${total.toFixed(2)}</span>
          </div>
        </div>
      `;
    }

    function updateQuantity(productId, change) {
      const item = cart.find(i => i.id === productId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          updateCartBadge();
          renderCart();
        }
      }
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      updateCartBadge();
      renderCart();
      showToast('Item removed from cart');
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    function navigateToPage(pageId) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(`${pageId}-page`).classList.add('active');
      window.scrollTo(0, 0);
    }

    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const pageId = e.target.getAttribute('href').substring(1);
        navigateToPage(pageId);
      });
    });

    document.getElementById('contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      
      submitBtn.disabled = true;
      submitText.textContent = 'Sending...';
      submitBtn.innerHTML = '<div class="loading-spinner"></div>';
      
      const formData = {
        id: Date.now().toString(),
        name: document.getElementById('name-input').value,
        email: document.getElementById('email-input').value,
        phone: document.getElementById('phone-input').value,
        message: document.getElementById('message-input').value,
        submittedAt: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(formData);
      
      submitBtn.disabled = false;
      
      if (result.isOk) {
        showToast('Message sent successfully! We\'ll get back to you soon.');
        document.getElementById('contact-form').reset();
        submitBtn.innerHTML = '<span id="submit-text">Send Message</span>';
        const config = window.elementSdk?.config || defaultConfig;
        submitBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
        submitBtn.style.color = config.surface_color || defaultConfig.surface_color;
      } else {
        showToast('Failed to send message. Please try again.');
        submitBtn.innerHTML = '<span id="submit-text">Send Message</span>';
      }
    });

    async function init() {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["shop_name", config.shop_name || defaultConfig.shop_name],
            ["tagline", config.tagline || defaultConfig.tagline],
            ["about_text", config.about_text || defaultConfig.about_text],
            ["contact_heading", config.contact_heading || defaultConfig.contact_heading]
          ])
        });
      }
      
      await onConfigChange(window.elementSdk?.config || defaultConfig);
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a90caa7c2bc6091',t:'MTc2NDkwODg1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
